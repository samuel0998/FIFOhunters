<!DOCTYPE html>
<html>
<head>
    <title>FIFO Hunters</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div class="top">
    <h1>FIFO HUNTERS</h1>
    <a href="{{ url_for('upload_page') }}" class="btn-upload">
        Atualizar Planilha
    </a>
</div>


<div class="scan-box">
    <input id="scanInput" placeholder="EAN / ASIN / ISD" autofocus>
    <button onclick="scanFIFO()">Scan</button>
</div>

<div id="results"></div>

<script>
async function scanFIFO() {
    const code = document.getElementById("scanInput").value.trim();
    const container = document.getElementById("results");

    container.innerHTML = "<p>Buscando...</p>";

    if (!code) {
        container.innerHTML = "<p>Informe um c√≥digo</p>";
        return;
    }

    const res = await fetch(`/api/scan?code=${code}`);
    const data = await res.json();

    if (!data.length) {
        container.innerHTML = "<p>Nenhum dado encontrado</p>";
        return;
    }

    container.innerHTML = "";

    data.forEach(item => {
        const card = document.createElement("div");
        const statusClass = item.status
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "");

card.className = `card ${statusClass}`;

        card.innerHTML = `
    <h3>${item.produto}</h3>
    <p><b>ISA:</b> ${item.isa ?? "-"}</p>
    <p><b>ISD:</b> ${item.isd}</p>
    <p><b>Data abertura:</b> ${item.data_abertura || "-"}</p>
    <p><b>Esperado:</b> ${item.quantidade_esperada}</p>
    <p><b>Recebido:</b> ${item.quantidade_recebida}</p>

    <div class="highlight">
        <div>
            <span>FALTA / SOBRA</span>
            <strong>${item.falta_receber}</strong>
        </div>

        <div>
            <span>FIFO DAYS</span>
            <strong>${item.fifo_days}</strong>
        </div>

        <div>
            <span>STATUS</span>
            <div class="status-badge">${item.status}</div>
        </div>
    </div>
`;


        container.appendChild(card);
    });
}
</script>

</body>
</html>
